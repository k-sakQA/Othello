# Othello - Playwright E2Eãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ« è©³ç´°è¨­è¨ˆæ›¸

**ã‚·ã‚¹ãƒ†ãƒ å**: Othello  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0  
**ä½œæˆæ—¥**: 2025å¹´10æœˆ13æ—¥  
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆåŠè‡ªå‹•ç‰ˆï¼‰  
**é–¢é€£æ–‡æ›¸**: othello-requirements-v2.md v1.0

---

## 1. è¨­è¨ˆæ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ åã®ç”±æ¥
ã€ŒOthelloï¼ˆã‚ªã‚»ãƒ­ï¼‰ã€ã¨ã„ã†åå‰ã¯ã€ä»¥ä¸‹ã®æ„å‘³ã‚’è¾¼ã‚ã¦ã„ã¾ã™ï¼š

**Playwrightã¨ã®ç¹‹ãŒã‚Š**ï¼š
- Playwrightï¼ˆåŠ‡ä½œå®¶ï¼‰ã¨ã„ãˆã°ã‚·ã‚§ã‚¤ã‚¯ã‚¹ãƒ”ã‚¢
- ã‚·ã‚§ã‚¤ã‚¯ã‚¹ãƒ”ã‚¢ã®å››å¤§æ‚²åŠ‡ã®ä¸€ã¤ãŒã€Œã‚ªã‚»ãƒ­ï¼ˆOthelloï¼‰ã€
- ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã€ŒPlaywrightã€ã‚’ä½¿ã†æœ¬ã‚·ã‚¹ãƒ†ãƒ ã«ãµã•ã‚ã—ã„åå‰

**ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã¸ã®æ„å‘³ã¥ã‘**ï¼š
- **é»’ã¨ç™½ã®åè»¢**: ãƒ†ã‚¹ãƒˆã®æˆåŠŸ/å¤±æ•—ã€å®Ÿè¡Œæ¸ˆã¿/æœªå®Ÿè¡Œã®çŠ¶æ…‹ã‚’è¡¨ç¾ï¼ˆã‚ªã‚»ãƒ­ã‚²ãƒ¼ãƒ ã®çŸ³ã®åè»¢ã®ã‚ˆã†ã«ï¼‰
- **æˆ¦ç•¥çš„ãªæ€è€ƒ**: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æˆ¦ç•¥çš„ã«å‘ä¸Šã•ã›ã‚‹ï¼ˆã‚ªã‚»ãƒ­ã‚²ãƒ¼ãƒ ã®æˆ¦ç•¥æ€§ï¼‰
- **ç›¤é¢ã®å¯è¦–åŒ–**: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡ŒçŠ¶æ³ã‚’ç›¤é¢ã®ã‚ˆã†ã«å¯è¦–åŒ–

### 1.2 è¨­è¨ˆæ–¹é‡
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç‰¹åŒ–**: Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®æŒ‡ç¤ºã¨çµæœåé›†ã«å°‚å¿µ
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®å§”è­²**: å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¯Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å®Œå…¨å§”è­²
- **æ‹¡å¼µæ€§**: å°†æ¥ã®ãƒ•ã‚§ãƒ¼ã‚º3å¯¾å¿œã‚’è¦‹æ®ãˆãŸè¨­è¨ˆ
- **å¯èª­æ€§**: QAæ‹…å½“è€…ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰æ§‹é€ 

### 1.3 Othelloã®è²¬å‹™
**OthelloãŒè¡Œã†ã“ã¨**ï¼š
- Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºç”Ÿæˆ
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã®åé›†ã¨CSV/JSONä¿å­˜
- æœªå®Ÿè¡Œç®‡æ‰€ã®åˆ†æ
- æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºç”Ÿæˆ
- å®Ÿè¡Œãƒ«ãƒ¼ãƒ—ã®ç®¡ç†

**OthelloãŒè¡Œã‚ãªã„ã“ã¨**ï¼š
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç›´æ¥æ“ä½œ
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œ
- ã‚»ãƒ¬ã‚¯ã‚¿ã®è§£æ±º
- ã‚¨ãƒ©ãƒ¼ã®ãƒªãƒˆãƒ©ã‚¤å‡¦ç†

### 1.4 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CLI Interface (othello.js)              â”‚
â”‚          ã‚³ãƒãƒ³ãƒ‰è§£æãƒ»å®Ÿè¡Œãƒ•ãƒ­ãƒ¼åˆ¶å¾¡                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Config Manager (config.js)                 â”‚
â”‚     è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ãƒ»ç’°å¢ƒå¤‰æ•°ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Orchestrator    â”‚ â”‚   Analyzer     â”‚ â”‚  Instruction     â”‚
â”‚   (æŒ‡ç¤ºç”Ÿæˆ)     â”‚ â”‚  (æœªå®Ÿè¡Œæ¤œå‡º)  â”‚ â”‚   Generator      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                  â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚    â”‚
         â–¼    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           VS Code Playwright Agent                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ Planner  â†’ Generator â†’ Healer           â”‚       â”‚
â”‚   â”‚ (ãƒ†ã‚¹ãƒˆè€ƒæ¡ˆ) (å®Ÿè¡Œ)    (ä¿®å¾©)           â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ å®Ÿè¡Œçµæœ
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Result Collector (result-collector.js)       â”‚
â”‚            å®Ÿè¡Œçµæœã®åé›†ã¨ãƒ‘ãƒ¼ã‚¹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CSV Writer      â”‚ â”‚  JSON Logger     â”‚
â”‚  (CSVä¿å­˜)       â”‚ â”‚  (JSONä¿å­˜)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Reporter      â”‚
        â”‚  (HTMLç”Ÿæˆ)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°è¨­è¨ˆ

### 2.1 CLI Interface (`bin/othello.js`)

#### 2.1.1 è²¬å‹™
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®ãƒ‘ãƒ¼ã‚¹
- å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‘¼ã³å‡ºã—åˆ¶å¾¡
- ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã®ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±

#### 2.1.2 ä¸»è¦ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼
```javascript
#!/usr/bin/env node

const { Command } = require('commander');
const Orchestrator = require('../src/orchestrator');
const ResultCollector = require('../src/result-collector');
const Analyzer = require('../src/analyzer');
const InstructionGenerator = require('../src/instruction-generator');
const Reporter = require('../src/reporter');
const ConfigManager = require('../src/config');

async function main() {
  const program = new Command();
  
  program
    .name('othello')
    .description('Playwright E2Eãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼')
    .version('2.0.0')
    .requiredOption('--url <url>', 'ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®URL')
    .option('--max-iterations <n>', 'æœ€å¤§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°', '10')
    .option('--browser <type>', 'ãƒ–ãƒ©ã‚¦ã‚¶ç¨®åˆ¥ (chromium/firefox/webkit)', 'chromium')
    .option('--output <dir>', 'ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›å…ˆ', './reports')
    .option('--config <path>', 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹', './config/default.json')
    .option('--auto-approve', 'å…¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•å®Ÿè¡Œ', false)
    .parse(process.argv);

  const options = program.opts();
  const maxIterations = parseInt(options.maxIterations);

  try {
    console.log('ğŸ® Othello - Playwright E2Eãƒ†ã‚¹ãƒˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ v2.0\n');
    
    // 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
    console.log('ğŸ“‹ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...');
    const config = await ConfigManager.load(options.config);
    
    console.log(`ğŸŒ å¯¾è±¡URL: ${options.url}`);
    console.log(`ğŸ”§ ãƒ–ãƒ©ã‚¦ã‚¶: ${options.browser}`);
    console.log(`ğŸ”„ æœ€å¤§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ${maxIterations}å›\n`);
    
    // 2. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®åˆæœŸåŒ–
    const orchestrator = new Orchestrator(config, options);
    const resultCollector = new ResultCollector(config);
    const analyzer = new Analyzer(config);
    const instructionGenerator = new InstructionGenerator(config);
    const reporter = new Reporter(config);
    
    // 3. ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
    for (let iteration = 1; iteration <= maxIterations; iteration++) {
      console.log(`\n${'='.repeat(60)}`);
      console.log(`ğŸ”„ ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ${iteration}/${maxIterations}`);
      console.log(`${'='.repeat(60)}\n`);
      
      // 3.1. Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
      let testInstructions;
      if (iteration === 1) {
        // åˆå›ã¯å¯¾è±¡URLã®ã¿ã‚’æŒ‡ç¤º
        testInstructions = {
          iteration: 1,
          target_url: options.url,
          instruction: 'å¯¾è±¡URLã®åŸºæœ¬çš„ãªæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„'
        };
        console.log('ğŸ“ åˆå›å®Ÿè¡Œ: å¯¾è±¡URLã®åŸºæœ¬æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ\n');
      } else {
        // 2å›ç›®ä»¥é™ã¯æœªå®Ÿè¡Œç®‡æ‰€ã‚’åˆ†æã—ã¦æŒ‡ç¤ºç”Ÿæˆ
        console.log('ğŸ” æœªå®Ÿè¡Œãƒ†ã‚¹ãƒˆã‚’åˆ†æã—ã¦ã„ã¾ã™...');
        const coverage = await analyzer.analyze();
        
        console.log(`ğŸ“Š ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸: ${coverage.coverage_summary.percentage}%`);
        console.log(`ğŸ“„ æœªè¨ªå•ãƒšãƒ¼ã‚¸: ${coverage.coverage_summary.unvisited_pages}ä»¶`);
        console.log(`ğŸ”˜ æœªæ“ä½œè¦ç´ : ${coverage.coverage_summary.untested_elements}ä»¶\n`);
        
        if (coverage.coverage_summary.unvisited_pages === 0 && 
            coverage.coverage_summary.untested_elements === 0) {
          console.log('âœ¨ å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\n');
          break;
        }
        
        // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
        console.log('ğŸ“ æ¬¡ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...');
        testInstructions = await instructionGenerator.generate(coverage, iteration);
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªï¼ˆauto-approveã§ãªã„å ´åˆï¼‰
        if (!options.autoApprove) {
          const approved = await promptUserApproval(testInstructions);
          if (!approved) {
            console.log('âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚Šã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ\n');
            break;
          }
        }
      }
      
      // 3.2. Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’é€ä¿¡
      console.log('ğŸš€ Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’é€ä¿¡ã—ã¦ã„ã¾ã™...\n');
      const agentResult = await orchestrator.executeIteration(
        options.url,
        testInstructions,
        iteration
      );
      
      // 3.3. å®Ÿè¡Œçµæœã‚’åé›†
      console.log('ğŸ“¥ å®Ÿè¡Œçµæœã‚’åé›†ã—ã¦ã„ã¾ã™...');
      const collectedResult = await resultCollector.collect(agentResult, iteration);
      
      // 3.4. çµæœã‚’CSV/JSONã§ä¿å­˜
      console.log('ğŸ’¾ å®Ÿè¡Œçµæœã‚’ä¿å­˜ã—ã¦ã„ã¾ã™...');
      await resultCollector.saveJSON(collectedResult);
      await resultCollector.saveCSV(collectedResult);
      
      console.log(`âœ… ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³${iteration}å®Œäº†`);
      console.log(`   - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ•°: ${collectedResult.tests_executed}ä»¶`);
      console.log(`   - æˆåŠŸ: ${collectedResult.tests_passed}ä»¶`);
      console.log(`   - å¤±æ•—: ${collectedResult.tests_failed}ä»¶`);
      if (collectedResult.healer_actions > 0) {
        console.log(`   - Healerä¿®å¾©: ${collectedResult.healer_actions}ä»¶`);
      }
    }
    
    // 4. æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    console.log('\nğŸ“Š æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...');
    const reportPath = await reporter.generate();
    
    console.log(`âœ… ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: ${reportPath}`);
    console.log(`\nğŸ‰ Othelloå®Ÿè¡Œå®Œäº†ï¼\n`);
    
  } catch (error) {
    console.error(`\nâŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}\n`);
    console.error(error.stack);
    process.exit(1);
  }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
async function promptUserApproval(testInstructions) {
  const readline = require('readline');
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

  console.log('\næ¬¡ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ:\n');
  
  if (testInstructions.test_instructions) {
    testInstructions.test_instructions.forEach((inst, index) => {
      console.log(`[${index + 1}] ${inst.target} ï¼ˆå„ªå…ˆåº¦: ${inst.priority}ï¼‰`);
      console.log(`    ${inst.instruction}`);
    });
  }
  
  return new Promise((resolve) => {
    rl.question('\næ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): ', (answer) => {
      rl.close();
      resolve(answer.toLowerCase() === 'y');
    });
  });
}

// å®Ÿè¡Œ
main().catch(error => {
  console.error('Fatal error:', error);
  process.exit(1);
});
```

#### 2.1.3 package.json
```json
{
  "name": "othello",
  "version": "2.0.0",
  "description": "Playwright E2Eãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼",
  "main": "bin/othello.js",
  "bin": {
    "othello": "./bin/othello.js"
  },
  "scripts": {
    "start": "node bin/othello.js",
    "test": "jest"
  },
  "keywords": ["playwright", "e2e", "testing", "automation", "orchestrator"],
  "author": "",
  "license": "MIT",
  "dependencies": {
    "commander": "^11.0.0",
    "winston": "^3.11.0",
    "dotenv": "^16.3.1",
    "handlebars": "^4.7.8",
    "csv-writer": "^1.6.0",
    "axios": "^1.6.0"
  },
  "devDependencies": {
    "jest": "^29.7.0"
  }
}
```

---

### 2.2 Config Manager (`src/config.js`)

#### 2.2.1 è²¬å‹™
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ç’°å¢ƒå¤‰æ•°ã®å–å¾—ã¨ç®¡ç†
- Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé€£æºè¨­å®šã®ç®¡ç†

#### 2.2.2 å®Ÿè£…
```javascript
const fs = require('fs').promises;
const path = require('path');
require('dotenv').config();

class ConfigManager {
  constructor(configData) {
    this.config = configData;
    this.validateConfig();
  }

  // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
  static async load(configPath) {
    try {
      const data = await fs.readFile(configPath, 'utf8');
      const config = JSON.parse(data);
      return new ConfigManager(config);
    } catch (error) {
      throw new Error(`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`);
    }
  }

  // è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  validateConfig() {
    const required = ['default_browser', 'timeout_seconds', 'max_iterations', 'paths'];
    for (const key of required) {
      if (!this.config[key]) {
        throw new Error(`å¿…é ˆè¨­å®šé …ç›®ãŒä¸è¶³: ${key}`);
      }
    }
    
    // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã®ç¢ºèª
    if (!this.config.playwright_agent) {
      console.warn('âš ï¸  Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
      this.config.playwright_agent = {
        planner_settings: {},
        healer_settings: {
          max_retry_attempts: 3
        }
      };
    }
  }

  // å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ã®å–å¾—
  getTargetSystem(name) {
    return this.config.target_systems.find(s => s.name === name);
  }

  // èªè¨¼æƒ…å ±ã®å–å¾—ï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰ï¼‰
  getCredentials(systemName) {
    const system = this.getTargetSystem(systemName);
    if (!system || !system.credentials) {
      return null;
    }

    return {
      username: process.env[system.credentials.username_env],
      password: process.env[system.credentials.password_env]
    };
  }

  // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã®å–å¾—
  getPlaywrightAgentSettings() {
    return this.config.playwright_agent || {};
  }

  // Claude APIè¨­å®šã®å–å¾—
  getClaudeAPISettings() {
    return this.config.claude_api || {
      model: 'claude-sonnet-4-20250514',
      max_tokens: 4096,
      temperature: 0.7
    };
  }

  // ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã®å–å¾—
  getCoverageThreshold() {
    return this.config.coverage_threshold || {
      target_percentage: 80,
      stop_if_no_improvement: true
    };
  }

  // ãƒ‘ã‚¹ã®å–å¾—
  getPath(type) {
    return this.config.paths[type] || `./${type}`;
  }

  // è¨­å®šå€¤ã®å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å¯¾å¿œï¼‰
  get(key, defaultValue = null) {
    return this.config[key] !== undefined ? this.config[key] : defaultValue;
  }
}

module.exports = ConfigManager;
```

#### 2.2.3 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹
```json
{
  "default_browser": "chromium",
  "timeout_seconds": 60,
  "max_iterations": 10,
  "screenshot_on_error": true,
  "paths": {
    "logs": "./logs",
    "results": "./results",
    "test_instructions": "./test-instructions",
    "reports": "./reports",
    "screenshots": "./screenshots"
  },
  "target_systems": [
    {
      "name": "ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ A",
      "url": "https://internal-system.company.com",
      "login_required": true,
      "credentials": {
        "username_env": "TEST_USER",
        "password_env": "TEST_PASS"
      }
    }
  ],
  "playwright_agent": {
    "vscode_workspace": "/path/to/workspace",
    "api_endpoint": "http://localhost:3000/playwright-agent",
    "planner_settings": {
      "test_generation_strategy": "comprehensive",
      "focus_on_edge_cases": true
    },
    "healer_settings": {
      "max_retry_attempts": 3,
      "auto_fix_selectors": true
    }
  },
  "claude_api": {
    "model": "claude-sonnet-4-20250514",
    "max_tokens": 4096,
    "temperature": 0.7
  },
  "coverage_threshold": {
    "target_percentage": 80,
    "stop_if_no_improvement": true
  }
}
```

---

### 2.3 Orchestrator (`src/orchestrator.js`)

#### 2.3.1 è²¬å‹™
- Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºé€ä¿¡
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é€šä¿¡ç®¡ç†
- å®Ÿè¡Œçµæœã®å—ä¿¡

#### 2.3.2 å®Ÿè£…
```javascript
const axios = require('axios');
const fs = require('fs').promises;
const path = require('path');

class Orchestrator {
  constructor(config, options) {
    this.config = config;
    this.options = options;
    this.agentSettings = config.getPlaywrightAgentSettings();
  }

  // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
  async executeIteration(targetUrl, testInstructions, iteration) {
    console.log(`ğŸ“¡ Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨é€šä¿¡ä¸­...\n`);
    
    // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    await this.saveTestInstructions(testInstructions, iteration);
    
    // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™
    // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€VS Codeæ‹¡å¼µã®APIã‚’å‘¼ã³å‡ºã™ã‹ã€
    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã§ã®é€£æºã‚’è¡Œã†
    const result = await this.callPlaywrightAgent(targetUrl, testInstructions);
    
    return result;
  }

  // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™
  async callPlaywrightAgent(targetUrl, testInstructions) {
    // å®Ÿè£…æ–¹æ³•1: REST APIçµŒç”±ï¼ˆVS Codeæ‹¡å¼µãŒAPIã‚’æä¾›ã—ã¦ã„ã‚‹å ´åˆï¼‰
    if (this.agentSettings.api_endpoint) {
      return await this.callViaAPI(targetUrl, testInstructions);
    }
    
    // å®Ÿè£…æ–¹æ³•2: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹é€£æºï¼ˆæ¨å¥¨ï¼‰
    return await this.callViaFileSystem(targetUrl, testInstructions);
  }

  // APIçµŒç”±ã§ã®å‘¼ã³å‡ºã—
  async callViaAPI(targetUrl, testInstructions) {
    try {
      const response = await axios.post(this.agentSettings.api_endpoint, {
        target_url: targetUrl,
        instructions: testInstructions,
        browser: this.options.browser,
        planner_settings: this.agentSettings.planner_settings,
        healer_settings: this.agentSettings.healer_settings
      }, {
        timeout: this.config.get('timeout_seconds', 60) * 1000
      });
      
      return response.data;
    } catch (error) {
      throw new Error(`Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
    }
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ çµŒç”±ã§ã®å‘¼ã³å‡ºã—
  async callViaFileSystem(targetUrl, testInstructions) {
    console.log('ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹é€£æºã‚’ä½¿ç”¨ã—ã¾ã™');
    console.log('â„¹ï¸  VS Codeã§Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ‰‹å‹•å®Ÿè¡Œã—ã¦ãã ã•ã„\n');
    
    // æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    const instructionPath = path.join(
      this.config.getPath('test_instructions'),
      `instruction_iteration-${testInstructions.iteration}.json`
    );
    
    await fs.writeFile(
      instructionPath,
      JSON.stringify(testInstructions, null, 2),
      'utf8'
    );
    
    console.log(`âœ… ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ: ${instructionPath}`);
    console.log('\næ¬¡ã®æ‰‹é †ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
    console.log('1. VS Codeã‚’é–‹ã');
    console.log('2. Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•');
    console.log(`3. æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ« (${instructionPath}) ã‚’èª­ã¿è¾¼ã¿`);
    console.log('4. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ');
    console.log('5. çµæœãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ\n');
    
    // çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºç¾ã‚’å¾…æ©Ÿ
    const resultPath = path.join(
      this.config.getPath('logs'),
      `result_iteration-${testInstructions.iteration}.json`
    );
    
    console.log(`â³ çµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾…æ©Ÿä¸­: ${resultPath}`);
    console.log('   ï¼ˆCtrl+Cã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰\n');
    
    const result = await this.waitForResultFile(resultPath);
    
    console.log('âœ… çµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡ºã—ã¾ã—ãŸ\n');
    
    return result;
  }

  // çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºç¾ã‚’å¾…æ©Ÿ
  async waitForResultFile(resultPath, maxWaitMinutes = 30) {
    const maxWaitMs = maxWaitMinutes * 60 * 1000;
    const checkIntervalMs = 5000; // 5ç§’ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
    const startTime = Date.now();
    
    while (Date.now() - startTime < maxWaitMs) {
      try {
        // ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
        await fs.access(resultPath);
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å†…å®¹ã‚’èª­ã¿è¾¼ã¿
        const content = await fs.readFile(resultPath, 'utf8');
        const result = JSON.parse(content);
        
        return result;
      } catch (error) {
        // ãƒ•ã‚¡ã‚¤ãƒ«ãŒã¾ã å­˜åœ¨ã—ãªã„å ´åˆã¯å¾…æ©Ÿ
        await new Promise(resolve => setTimeout(resolve, checkIntervalMs));
      }
    }
    
    throw new Error(`ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ${maxWaitMinutes}åˆ†ä»¥å†…ã«çµæœãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ`);
  }

  // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
  async saveTestInstructions(testInstructions, iteration) {
    const instructionsPath = this.config.getPath('test_instructions');
    
    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    try {
      await fs.access(instructionsPath);
    } catch {
      await fs.mkdir(instructionsPath, { recursive: true });
    }
    
    const filename = `test-instructions_iteration-${iteration}.json`;
    const filepath = path.join(instructionsPath, filename);
    
    await fs.writeFile(filepath, JSON.stringify(testInstructions, null, 2), 'utf8');
    
    // Markdownç‰ˆã‚‚ä¿å­˜
    const markdown = this.convertInstructionsToMarkdown(testInstructions);
    const mdFilepath = filepath.replace('.json', '.md');
    await fs.writeFile(mdFilepath, markdown, 'utf8');
  }

  // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’Markdownå½¢å¼ã«å¤‰æ›
  convertInstructionsToMarkdown(testInstructions) {
    let md = `# ãƒ†ã‚¹ãƒˆæŒ‡ç¤º - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ${testInstructions.iteration}\n\n`;
    md += `ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}\n\n`;
    
    if (testInstructions.target_url) {
      md += `## å¯¾è±¡URL\n${testInstructions.target_url}\n\n`;
    }
    
    if (testInstructions.instruction) {
      md += `## æŒ‡ç¤º\n${testInstructions.instruction}\n\n`;
    }
    
    if (testInstructions.test_instructions) {
      md += `## è©³ç´°æŒ‡ç¤º\n\n`;
      testInstructions.test_instructions.forEach((inst, index) => {
        md += `### ${index + 1}. ${inst.target} ï¼ˆå„ªå…ˆåº¦: ${inst.priority}ï¼‰\n\n`;
        md += `${inst.instruction}\n\n`;
        
        if (inst.focus_areas && inst.focus_areas.length > 0) {
          md += `é‡ç‚¹é ˜åŸŸ:\n`;
          inst.focus_areas.forEach(area => {
            md += `- ${area}\n`;
          });
          md += `\n`;
        }
      });
    }
    
    return md;
  }
}

module.exports = Orchestrator;
```

---

### 2.4 Result Collector (`src/result-collector.js`)

#### 2.4.1 è²¬å‹™
- Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè¡Œçµæœã®åé›†
- çµæœã®ãƒ‘ãƒ¼ã‚¹ã¨æ§‹é€ åŒ–
- JSON/CSVå½¢å¼ã§ã®ä¿å­˜

#### 2.4.2 å®Ÿè£…
```javascript
const fs = require('fs').promises;
const path = require('path');
const createCsvWriter = require('csv-writer').createObjectCsvWriter;

class ResultCollector {
  constructor(config) {
    this.config = config;
  }

  // å®Ÿè¡Œçµæœã‚’åé›†
  async collect(agentResult, iteration) {
    // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çµæœã‚’æ¨™æº–å½¢å¼ã«å¤‰æ›
    const collectedResult = {
      execution_id: `iteration-${iteration}_${new Date().toISOString()}`,
      iteration: iteration,
      target_url: agentResult.target_url || '',
      browser: agentResult.browser || 'chromium',
      start_time: agentResult.start_time || new Date().toISOString(),
      end_time: agentResult.end_time || new Date().toISOString(),
      duration_seconds: agentResult.duration_seconds || 0,
      status: agentResult.status || 'unknown',
      tests_generated_by_planner: agentResult.tests_generated || [],
      tests_executed: agentResult.tests_executed || 0,
      tests_passed: agentResult.tests_passed || 0,
      tests_failed: agentResult.tests_failed || 0,
      healer_actions: agentResult.healer_actions || 0,
      playwright_agent_results: {
        planner_suggestions: agentResult.planner_suggestions || [],
        generated_tests: agentResult.generated_tests || [],
        healer_actions: agentResult.healer_details || [],
        test_details: agentResult.test_details || []
      }
    };
    
    return collectedResult;
  }

  // JSONå½¢å¼ã§ä¿å­˜
  async saveJSON(result) {
    const logsPath = this.config.getPath('logs');
    await this.ensureDirectory(logsPath);
    
    const filename = `${result.execution_id}.json`.replace(/[^a-zA-Z0-9_-]/g, '_');
    const filepath = path.join(logsPath, filename);
    
    await fs.writeFile(filepath, JSON.stringify(result, null, 2), 'utf8');
    
    console.log(`   âœ… JSONãƒ­ã‚°: ${filepath}`);
    
    return filepath;
  }

  // CSVå½¢å¼ã§ä¿å­˜
  async saveCSV(result) {
    const resultsPath = this.config.getPath('results');
    await this.ensureDirectory(resultsPath);
    
    const timestamp = new Date().toISOString().split('T')[0];
    const csvPath = path.join(resultsPath, `test-results_${timestamp}.csv`);
    
    // ãƒ†ã‚¹ãƒˆè©³ç´°ã‚’CSVè¡Œã«å¤‰æ›
    const csvRows = this.convertToCSVRows(result);
    
    if (csvRows.length === 0) {
      console.log('   âš ï¸  CSVæ›¸ãè¾¼ã¿ã‚¹ã‚­ãƒƒãƒ—: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãªã—');
      return csvPath;
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
    const fileExists = await this.fileExists(csvPath);
    
    // CSVãƒ©ã‚¤ã‚¿ãƒ¼ä½œæˆ
    const csvWriter = createCsvWriter({
      path: csvPath,
      header: this.getCSVHeaders(),
      append: fileExists,
      encoding: 'utf8'
    });
    
    await csvWriter.writeRecords(csvRows);
    
    console.log(`   âœ… CSVçµæœ: ${csvPath} (${csvRows.length}ä»¶è¿½åŠ )`);
    
    return csvPath;
  }

  // ãƒ†ã‚¹ãƒˆçµæœã‚’CSVè¡Œã®é…åˆ—ã«å¤‰æ›
  convertToCSVRows(result) {
    const rows = [];
    
    // test_detailsã‹ã‚‰CSVè¡Œã‚’ç”Ÿæˆ
    if (result.playwright_agent_results.test_details) {
      result.playwright_agent_results.test_details.forEach((test, index) => {
        rows.push({
          no: `${result.iteration}-${index + 1}`,
          scenario: test.name || test.description || `ãƒ†ã‚¹ãƒˆ${index + 1}`,
          status: test.status === 'passed' ? 'æˆåŠŸ' : test.status === 'failed' ? 'å¤±æ•—' : 'ã‚¨ãƒ©ãƒ¼',
          input1: test.inputs && test.inputs[0] ? test.inputs[0] : '',
          input2: test.inputs && test.inputs[1] ? test.inputs[1] : '',
          input3: test.inputs && test.inputs[2] ? test.inputs[2] : '',
          input4: test.inputs && test.inputs[3] ? test.inputs[3] : '',
          input5: test.inputs && test.inputs[4] ? test.inputs[4] : '',
          remarks: this.generateRemarks(test, result)
        });
      });
    } else if (result.tests_generated_by_planner) {
      // test_detailsãŒãªã„å ´åˆã€plannerææ¡ˆã‹ã‚‰ç°¡æ˜“çš„ãªCSVã‚’ç”Ÿæˆ
      result.tests_generated_by_planner.forEach((testName, index) => {
        rows.push({
          no: `${result.iteration}-${index + 1}`,
          scenario: `${testName}ï¼ˆPlannerææ¡ˆï¼‰`,
          status: index < result.tests_passed ? 'æˆåŠŸ' : 'å¤±æ•—',
          input1: '',
          input2: '',
          input3: '',
          input4: '',
          input5: '',
          remarks: ''
        });
      });
    }
    
    return rows;
  }

  // å‚™è€ƒæ¬„ã®ç”Ÿæˆ
  generateRemarks(test, result) {
    const remarks = [];
    
    if (test.expected_result) {
      remarks.push(test.expected_result);
    }
    
    if (test.healed) {
      remarks.push('Healerã«ã‚ˆã‚Šä¿®å¾©');
    }
    
    if (test.error_message) {
      remarks.push(`ã‚¨ãƒ©ãƒ¼: ${test.error_message}`);
    }
    
    return remarks.join(', ');
  }

  // CSVãƒ˜ãƒƒãƒ€ãƒ¼ã®å®šç¾©
  getCSVHeaders() {
    return [
      { id: 'no', title: 'No' },
      { id: 'scenario', title: 'ãƒ†ã‚¹ãƒˆæ¦‚è¦' },
      { id: 'status', title: 'å®Ÿè¡Œçµæœ' },
      { id: 'input1', title: 'å…¥åŠ›å€¤1' },
      { id: 'input2', title: 'å…¥åŠ›å€¤2' },
      { id: 'input3', title: 'å…¥åŠ›å€¤3' },
      { id: 'input4', title: 'å…¥åŠ›å€¤4' },
      { id: 'input5', title: 'å…¥åŠ›å€¤5' },
      { id: 'remarks', title: 'å‚™è€ƒ' }
    ];
  }

  // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å­˜åœ¨ç¢ºèªã¨ä½œæˆ
  async ensureDirectory(dirPath) {
    try {
      await fs.access(dirPath);
    } catch {
      await fs.mkdir(dirPath, { recursive: true });
    }
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
  async fileExists(filepath) {
    try {
      await fs.access(filepath);
      return true;
    } catch {
      return false;
    }
  }
}

module.exports = ResultCollector;
```

---

### 2.5 Analyzer (`src/analyzer.js`)

#### 2.5.1 è²¬å‹™
- å®Ÿè¡Œæ¸ˆã¿ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ã¨è§£æ
- æœªå®Ÿè¡Œãƒšãƒ¼ã‚¸ãƒ»è¦ç´ ã®æ¤œå‡º
- ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—

#### 2.5.2 å®Ÿè£…
```javascript
const fs = require('fs').promises;
const path = require('path');

class Analyzer {
  constructor(config) {
    this.config = config;
  }

  // æœªå®Ÿè¡Œãƒ†ã‚¹ãƒˆã®åˆ†æ
  async analyze() {
    // 1. å…¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
    const logs = await this.loadAllLogs();
    
    if (logs.length === 0) {
      return this.getEmptyCoverage();
    }
    
    // 2. è¨ªå•æ¸ˆã¿ãƒšãƒ¼ã‚¸ã‚’æŠ½å‡º
    const visitedPages = this.extractVisitedPages(logs);
    
    // 3. ãƒ†ã‚¹ãƒˆæ¸ˆã¿æ©Ÿèƒ½ã‚’æŠ½å‡º
    const testedFeatures = this.extractTestedFeatures(logs);
    
    // 4. å…¨ä½“ã®æ¨å®šãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
    const estimatedTotalPages = this.estimateTotalPages(logs);
    const estimatedTotalFeatures = this.estimateTotalFeatures(logs);
    
    // 5. æœªã‚«ãƒãƒ¼ç®‡æ‰€ã‚’ç‰¹å®š
    const uncoveredPages = this.findUncoveredPages(visitedPages, estimatedTotalPages);
    const uncoveredFeatures = this.findUncoveredFeatures(testedFeatures, estimatedTotalFeatures);
    
    // 6. ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¨ˆç®—
    const coverage = this.calculateCoverage(
      visitedPages.length,
      estimatedTotalPages,
      testedFeatures.length,
      estimatedTotalFeatures
    );
    
    return {
      analysis_date: new Date().toISOString(),
      total_scenarios_executed: logs.length,
      coverage_summary: {
        percentage: coverage,
        visited_pages: visitedPages.length,
        unvisited_pages: uncoveredPages.length,
        tested_elements: testedFeatures.length,
        untested_elements: uncoveredFeatures.length
      },
      uncovered: {
        pages: uncoveredPages,
        elements: uncoveredFeatures
      }
    };
  }

  // å…¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
  async loadAllLogs() {
    const logsPath = this.config.getPath('logs');
    
    try {
      const files = await fs.readdir(logsPath);
      const jsonFiles = files.filter(f => f.endsWith('.json'));
      
      const logs = [];
      for (const file of jsonFiles) {
        const filePath = path.join(logsPath, file);
        const content = await fs.readFile(filePath, 'utf8');
        logs.push(JSON.parse(content));
      }
      
      return logs;
    } catch (error) {
      console.log(`âš ï¸  ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
      return [];
    }
  }

  // è¨ªå•æ¸ˆã¿ãƒšãƒ¼ã‚¸ã®æŠ½å‡º
  extractVisitedPages(logs) {
    const pages = new Set();
    
    for (const log of logs) {
      if (log.target_url) {
        pages.add(log.target_url);
      }
      
      // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆè©³ç´°ã‹ã‚‰è¨ªå•ãƒšãƒ¼ã‚¸ã‚’æŠ½å‡º
      if (log.playwright_agent_results && log.playwright_agent_results.test_details) {
        for (const test of log.playwright_agent_results.test_details) {
          if (test.visited_urls) {
            test.visited_urls.forEach(url => pages.add(url));
          }
        }
      }
    }
    
    return Array.from(pages);
  }

  // ãƒ†ã‚¹ãƒˆæ¸ˆã¿æ©Ÿèƒ½ã®æŠ½å‡º
  extractTestedFeatures(logs) {
    const features = new Set();
    
    for (const log of logs) {
      // PlannerãŒç”Ÿæˆã—ãŸãƒ†ã‚¹ãƒˆåã‹ã‚‰æ©Ÿèƒ½ã‚’æŠ½å‡º
      if (log.tests_generated_by_planner) {
        log.tests_generated_by_planner.forEach(testName => {
          features.add(testName);
        });
      }
      
      // ãƒ†ã‚¹ãƒˆè©³ç´°ã‹ã‚‰æ©Ÿèƒ½ã‚’æŠ½å‡º
      if (log.playwright_agent_results && log.playwright_agent_results.test_details) {
        for (const test of log.playwright_agent_results.test_details) {
          if (test.feature) {
            features.add(test.feature);
          }
        }
      }
    }
    
    return Array.from(features);
  }

  // æ¨å®šç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
  estimateTotalPages(logs) {
    // ç°¡æ˜“çš„ãªæ¨å®š: è¨ªå•æ¸ˆã¿ãƒšãƒ¼ã‚¸æ•° Ã— 1.5
    // å®Ÿéš›ã«ã¯ã€ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚„ãƒªãƒ³ã‚¯è§£æã§ç²¾åº¦ã‚’ä¸Šã’ã‚‹
    const visitedCount = this.extractVisitedPages(logs).length;
    return Math.ceil(visitedCount * 1.5);
  }

  // æ¨å®šç·æ©Ÿèƒ½æ•°ã‚’è¨ˆç®—
  estimateTotalFeatures(logs) {
    // ç°¡æ˜“çš„ãªæ¨å®š: ãƒ†ã‚¹ãƒˆæ¸ˆã¿æ©Ÿèƒ½æ•° Ã— 2
    const testedCount = this.extractTestedFeatures(logs).length;
    return Math.max(testedCount * 2, 10); // æœ€ä½10æ©Ÿèƒ½ã¨ä»®å®š
  }

  // æœªã‚«ãƒãƒ¼ãƒšãƒ¼ã‚¸ã®æ¤œå‡º
  findUncoveredPages(visitedPages, estimatedTotal) {
    const uncovered = [];
    const uncoveredCount = Math.max(0, estimatedTotal - visitedPages.length);
    
    for (let i = 0; i < uncoveredCount; i++) {
      uncovered.push({
        type: 'page',
        name: `æœªè¨ªå•ãƒšãƒ¼ã‚¸ ${i + 1}`,
        url: 'unknown'
      });
    }
    
    return uncovered;
  }

  // æœªã‚«ãƒãƒ¼æ©Ÿèƒ½ã®æ¤œå‡º
  findUncoveredFeatures(testedFeatures, estimatedTotal) {
    const uncovered = [];
    const uncoveredCount = Math.max(0, estimatedTotal - testedFeatures.length);
    
    for (let i = 0; i < uncoveredCount; i++) {
      uncovered.push({
        type: 'element',
        page: 'unknown',
        element: `æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ ${i + 1}`,
        selector: 'unknown'
      });
    }
    
    return uncovered;
  }

  // ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆç®—
  calculateCoverage(visitedPages, totalPages, testedFeatures, totalFeatures) {
    if (totalPages === 0 && totalFeatures === 0) {
      return 0;
    }
    
    const pageCoverage = totalPages > 0 ? (visitedPages / totalPages) : 0;
    const featureCoverage = totalFeatures > 0 ? (testedFeatures / totalFeatures) : 0;
    
    // å¹³å‡ã‚«ãƒãƒ¬ãƒƒã‚¸
    const averageCoverage = ((pageCoverage + featureCoverage) / 2) * 100;
    
    return Math.round(averageCoverage * 10) / 10;
  }

  // ç©ºã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿
  getEmptyCoverage() {
    return {
      analysis_date: new Date().toISOString(),
      total_scenarios_executed: 0,
      coverage_summary: {
        percentage: 0,
        visited_pages: 0,
        unvisited_pages: 0,
        tested_elements: 0,
        untested_elements: 0
      },
      uncovered: {
        pages: [],
        elements: []
      }
    };
  }
}

module.exports = Analyzer;
```

---

### 2.6 Instruction Generator (`src/instruction-generator.js`)

#### 2.6.1 è²¬å‹™
- æœªå®Ÿè¡Œç®‡æ‰€ã‹ã‚‰ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
- Claude APIã‚’ä½¿ç”¨ã—ãŸæŒ‡ç¤ºã®æœ€é©åŒ–
- JSON/Markdownå½¢å¼ã§ã®æŒ‡ç¤ºå‡ºåŠ›

#### 2.6.2 å®Ÿè£…
```javascript
const fs = require('fs').promises;
const path = require('path');

class InstructionGenerator {
  constructor(config) {
    this.config = config;
  }

  // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã®ç”Ÿæˆ
  async generate(coverageData, iteration) {
    // æœªã‚«ãƒãƒ¼ç®‡æ‰€ã‹ã‚‰ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
    const instructions = {
      iteration: iteration,
      generated_at: new Date().toISOString(),
      test_instructions: []
    };
    
    // æœªè¨ªå•ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
    if (coverageData.uncovered.pages.length > 0) {
      const pageInstructions = this.generatePageInstructions(coverageData.uncovered.pages);
      instructions.test_instructions.push(...pageInstructions);
    }
    
    // æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã‹ã‚‰ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
    if (coverageData.uncovered.elements.length > 0) {
      const featureInstructions = this.generateFeatureInstructions(coverageData.uncovered.elements);
      instructions.test_instructions.push(...featureInstructions);
    }
    
    // Claude APIã§æŒ‡ç¤ºã‚’æœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if (this.config.get('use_claude_for_instructions', false)) {
      instructions.test_instructions = await this.optimizeWithClaude(instructions.test_instructions);
    }
    
    // å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆ
    instructions.test_instructions.sort((a, b) => {
      const priority = { high: 0, medium: 1, low: 2 };
      return priority[a.priority] - priority[b.priority];
    });
    
    return instructions;
  }

  // ãƒšãƒ¼ã‚¸ç”¨ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
  generatePageInstructions(uncoveredPages) {
    return uncoveredPages.slice(0, 5).map(page => ({
      priority: 'high',
      target: page.name,
      instruction: `${page.name}ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€åŸºæœ¬çš„ãªæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã€ä¸»è¦ãªè¦ç´ ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`,
      focus_areas: [
        'ãƒšãƒ¼ã‚¸ã®æ­£å¸¸ãªèª­ã¿è¾¼ã¿',
        'ä¸»è¦UIè¦ç´ ã®è¡¨ç¤ºç¢ºèª',
        'åŸºæœ¬çš„ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³'
      ]
    }));
  }

  // æ©Ÿèƒ½ç”¨ã®ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ç”Ÿæˆ
  generateFeatureInstructions(uncoveredFeatures) {
    return uncoveredFeatures.slice(0, 5).map(feature => ({
      priority: 'medium',
      target: feature.element,
      instruction: `${feature.element}ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚æ­£å¸¸ç³»ã¨ç•°å¸¸ç³»ã®ä¸¡æ–¹ã‚’ç¢ºèªã—ã€æœŸå¾…é€šã‚Šã®å‹•ä½œã‚’ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¦ãã ã•ã„ã€‚`,
      focus_areas: [
        'æ­£å¸¸ç³»ã®å‹•ä½œç¢ºèª',
        'ç•°å¸¸ç³»ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°',
        'ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ¤œè¨¼'
      ]
    }));
  }

  // Claude APIã§æŒ‡ç¤ºã‚’æœ€é©åŒ–
  async optimizeWithClaude(instructions) {
    // Claude APIã‚’ä½¿ç”¨ã—ã¦ã€ã‚ˆã‚Šå…·ä½“çš„ã§åŠ¹æœçš„ãªãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã«å¤‰æ›
    // å®Ÿè£…ä¾‹ï¼ˆå®Ÿéš›ã«ã¯Claude APIã‚’å‘¼ã³å‡ºã™ï¼‰
    console.log('   â„¹ï¸  Claude APIã«ã‚ˆã‚‹æŒ‡ç¤ºæœ€é©åŒ–ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ');
    return instructions;
  }
}

module.exports = InstructionGenerator;
```

---

### 2.7 Reporter (`src/reporter.js`)

#### 2.7.1 è²¬å‹™
- å…¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµæœã‚’é›†ç´„
- HTMLãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
- ã‚«ãƒãƒ¬ãƒƒã‚¸æ¨ç§»ã®å¯è¦–åŒ–

#### 2.7.2 å®Ÿè£…
```javascript
const fs = require('fs').promises;
const path = require('path');
const Handlebars = require('handlebars');

class Reporter {
  constructor(config) {
    this.config = config;
  }

  // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  async generate() {
    // 1. å…¨ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿
    const logs = await this.loadAllLogs();
    
    // 2. ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
    const summary = this.createSummary(logs);
    
    // 3. ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥çµæœã‚’ä½œæˆ
    const iterations = this.groupByIteration(logs);
    
    // 4. HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
    const html = await this.createHTML(summary, iterations);
    
    // 5. ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    const filepath = await this.save(html);
    
    return filepath;
  }

  // å…¨ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿
  async loadAllLogs() {
    const logsPath = this.config.getPath('logs');
    
    try {
      const files = await fs.readdir(logsPath);
      const jsonFiles = files.filter(f => f.endsWith('.json'));
      
      const logs = [];
      for (const file of jsonFiles) {
        const filePath = path.join(logsPath, file);
        const content = await fs.readFile(filePath, 'utf8');
        logs.push(JSON.parse(content));
      }
      
      // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é †ã«ã‚½ãƒ¼ãƒˆ
      logs.sort((a, b) => a.iteration - b.iteration);
      
      return logs;
    } catch (error) {
      console.log(`âš ï¸  ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
      return [];
    }
  }

  // ã‚µãƒãƒªãƒ¼ã®ä½œæˆ
  createSummary(logs) {
    const totalIterations = new Set(logs.map(l => l.iteration)).size;
    const totalTests = logs.reduce((sum, l) => sum + (l.tests_executed || 0), 0);
    const totalPassed = logs.reduce((sum, l) => sum + (l.tests_passed || 0), 0);
    const totalFailed = logs.reduce((sum, l) => sum + (l.tests_failed || 0), 0);
    const totalHealerActions = logs.reduce((sum, l) => sum + (l.healer_actions || 0), 0);
    
    const finalCoverage = logs.length > 0 ? this.calculateFinalCoverage(logs) : 0;
    
    return {
      totalIterations,
      totalTests,
      totalPassed,
      totalFailed,
      totalHealerActions,
      successRate: totalTests > 0 ? Math.round((totalPassed / totalTests) * 100) : 0,
      finalCoverage,
      lastExecutionDate: logs.length > 0 ? 
        new Date(logs[logs.length - 1].start_time).toLocaleString('ja-JP') : '-'
    };
  }

  // æœ€çµ‚ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¨ˆç®—
  calculateFinalCoverage(logs) {
    // ç°¡æ˜“å®Ÿè£…: å…¨ãƒ­ã‚°ã‹ã‚‰æ¨å®š
    // å®Ÿéš›ã«ã¯Analyzerã‚’å‘¼ã³å‡ºã—ã¦æ­£ç¢ºãªå€¤ã‚’å–å¾—
    const uniqueTests = new Set();
    logs.forEach(log => {
      if (log.tests_generated_by_planner) {
        log.tests_generated_by_planner.forEach(test => uniqueTests.add(test));
      }
    });
    
    // ä»®ã®ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—
    return Math.min(uniqueTests.size * 10, 100);
  }

  // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  groupByIteration(logs) {
    const iterations = new Map();
    
    logs.forEach(log => {
      const iter = log.iteration;
      if (!iterations.has(iter)) {
        iterations.set(iter, []);
      }
      iterations.get(iter).push(log);
    });
    
    const result = [];
    iterations.forEach((logs, iter) => {
      const totalTests = logs.reduce((sum, l) => sum + (l.tests_executed || 0), 0);
      const passed = logs.reduce((sum, l) => sum + (l.tests_passed || 0), 0);
      const failed = logs.reduce((sum, l) => sum + (l.tests_failed || 0), 0);
      const healerActions = logs.reduce((sum, l) => sum + (l.healer_actions || 0), 0);
      
      const duration = logs.reduce((sum, l) => sum + (l.duration_seconds || 0), 0);
      
      result.push({
        iteration: iter,
        totalTests,
        passed,
        failed,
        healerActions,
        duration: Math.round(duration),
        status: failed === 0 ? 'success' : 'partial',
        logs: logs,
        coverage: this.estimateIterationCoverage(iter, result.length + 1)
      });
    });
    
    return result;
  }

  // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¨å®š
  estimateIterationCoverage(iteration, totalIterations) {
    // ç°¡æ˜“çš„ãªæ¨å®š
    return Math.round((iteration / totalIterations) * 80);
  }

  // HTMLãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
  async createHTML(summary, iterations) {
    const template = this.getHTMLTemplate();
    const compiled = Handlebars.compile(template);
    
    // Handlebarsãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ç™»éŒ²
    Handlebars.registerHelper('statusIcon', function(status) {
      return status === 'success' ? 'âœ“' : 'âš ';
    });
    
    Handlebars.registerHelper('coverageChange', function(current, previous) {
      if (!previous) return '';
      const change = current - previous;
      return change > 0 ? `(â†‘${change}%)` : '';
    });
    
    return compiled({
      summary,
      iterations: iterations.map((iter, index) => ({
        ...iter,
        previousCoverage: index > 0 ? iterations[index - 1].coverage : 0
      })),
      generatedAt: new Date().toLocaleString('ja-JP')
    });
  }

  // HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  getHTMLTemplate() {
    return `
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Othello E2Eãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic', sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
    }
    
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .summary-card {
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .summary-card h3 {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .summary-card .value {
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
    }
    
    .iteration {
      background: white;
      padding: 30px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .iteration-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .iteration-title {
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .status {
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    
    .status.success {
      background: #c6f6d5;
      color: #22543d;
    }
    
    .status.partial {
      background: #feebc8;
      color: #7c2d12;
    }
    
    .iteration-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .stat-item {
      text-align: center;
      padding: 10px;
      background: #f7fafc;
      border-radius: 4px;
    }
    
    .stat-label {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #667eea;
    }
    
    .coverage-badge {
      display: inline-block;
      padding: 5px 15px;
      background: #667eea;
      color: white;
      border-radius: 20px;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .healer-note {
      margin-top: 15px;
      padding: 10px;
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    footer {
      text-align: center;
      padding: 40px 20px;
      color: #666;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ® Othello E2Eãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ</h1>
      <p class="subtitle">ç”Ÿæˆæ—¥æ™‚: {{generatedAt}}</p>
    </header>

    <section class="summary">
      <div class="summary-card">
        <h3>ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°</h3>
        <div class="value">{{summary.totalIterations}}</div>
      </div>
      <div class="summary-card">
        <h3>ç·ãƒ†ã‚¹ãƒˆæ•°</h3>
        <div class="value">{{summary.totalTests}}</div>
      </div>
      <div class="summary-card">
        <h3>æˆåŠŸç‡</h3>
        <div class="value">{{summary.successRate}}%</div>
      </div>
      <div class="summary-card">
        <h3>Healerä¿®å¾©</h3>
        <div class="value">{{summary.totalHealerActions}}</div>
      </div>
      <div class="summary-card">
        <h3>æœ€çµ‚ã‚«ãƒãƒ¬ãƒƒã‚¸</h3>
        <div class="value">{{summary.finalCoverage}}%</div>
      </div>
    </section>

    <h2 style="margin-bottom: 20px;">ğŸ“‹ ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥çµæœ</h2>

    {{#each iterations}}
    <div class="iteration">
      <div class="iteration-header">
        <div>
          <span class="iteration-title">ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ {{iteration}}</span>
          <span class="coverage-badge">ã‚«ãƒãƒ¬ãƒƒã‚¸: {{coverage}}% {{coverageChange coverage previousCoverage}}</span>
        </div>
        <div class="status {{status}}">{{statusIcon status}}</div>
      </div>

      <div class="iteration-stats">
        <div class="stat-item">
          <div class="stat-label">å®Ÿè¡Œæ™‚é–“</div>
          <div class="stat-value">{{duration}}ç§’</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ãƒ†ã‚¹ãƒˆæ•°</div>
          <div class="stat-value">{{totalTests}}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æˆåŠŸ</div>
          <div class="stat-value" style="color: #48bb78;">{{passed}}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¤±æ•—</div>
          <div class="stat-value" style="color: #f56565;">{{failed}}</div>
        </div>
      </div>

      {{#if healerActions}}
      <div class="healer-note">
        ğŸ”§ HealerãŒ{{healerActions}}ä»¶ã®ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•ä¿®å¾©ã—ã¾ã—ãŸ
      </div>
      {{/if}}
    </div>
    {{/each}}

    <footer>
      <p>Generated by Othello v2.0</p>
    </footer>
  </div>
</body>
</html>
    `;
  }

  // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
  async save(html) {
    const reportsPath = this.config.getPath('reports');
    
    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    try {
      await fs.access(reportsPath);
    } catch {
      await fs.mkdir(reportsPath, { recursive: true });
    }
    
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const filename = `report_${timestamp}.html`;
    const filepath = path.join(reportsPath, filename);
    
    await fs.writeFile(filepath, html, 'utf8');
    
    return filepath;
  }
}

module.exports = Reporter;
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 3.1 ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºï¼ˆTestInstructionï¼‰
```typescript
interface TestInstruction {
  iteration: number;              // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç•ªå·
  generated_at: string;           // ç”Ÿæˆæ—¥æ™‚ï¼ˆISO 8601ï¼‰
  target_url?: string;            // å¯¾è±¡URLï¼ˆåˆå›ã®ã¿ï¼‰
  instruction?: string;           // å…¨ä½“æŒ‡ç¤ºï¼ˆåˆå›ã®ã¿ï¼‰
  test_instructions: {            // è©³ç´°æŒ‡ç¤ºï¼ˆ2å›ç›®ä»¥é™ï¼‰
    priority: 'high' | 'medium' | 'low';
    target: string;               // ãƒ†ã‚¹ãƒˆå¯¾è±¡
    instruction: string;          // æŒ‡ç¤ºå†…å®¹
    focus_areas: string[];        // é‡ç‚¹é ˜åŸŸ
  }[];
}
```

### 3.2 å®Ÿè¡Œçµæœï¼ˆExecutionResultï¼‰
```typescript
interface ExecutionResult {
  execution_id: string;           // å®Ÿè¡ŒID
  iteration: number;              // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç•ªå·
  target_url: string;             // å¯¾è±¡URL
  browser: string;                // ãƒ–ãƒ©ã‚¦ã‚¶ç¨®åˆ¥
  start_time: string;             // é–‹å§‹æ™‚åˆ»ï¼ˆISO 8601ï¼‰
  end_time: string;               // çµ‚äº†æ™‚åˆ»ï¼ˆISO 8601ï¼‰
  duration_seconds: number;       // å®Ÿè¡Œæ™‚é–“ï¼ˆç§’ï¼‰
  status: 'success' | 'failure';  // å®Ÿè¡Œçµæœ
  tests_generated_by_planner: string[];  // PlannerãŒç”Ÿæˆã—ãŸãƒ†ã‚¹ãƒˆå
  tests_executed: number;         // å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°
  tests_passed: number;           // æˆåŠŸæ•°
  tests_failed: number;           // å¤±æ•—æ•°
  healer_actions: number;         // Healerä¿®å¾©æ•°
  playwright_agent_results: {     // Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è©³ç´°çµæœ
    planner_suggestions: string[];
    generated_tests: any[];
    healer_details: any[];
    test_details: TestDetail[];
  };
}
```

### 3.3 ãƒ†ã‚¹ãƒˆè©³ç´°ï¼ˆTestDetailï¼‰
```typescript
interface TestDetail {
  name: string;                   // ãƒ†ã‚¹ãƒˆå
  description?: string;           // ãƒ†ã‚¹ãƒˆèª¬æ˜
  status: 'passed' | 'failed' | 'error';  // ãƒ†ã‚¹ãƒˆçµæœ
  duration_seconds: number;       // å®Ÿè¡Œæ™‚é–“
  inputs?: string[];              // å…¥åŠ›å€¤
  expected_result?: string;       // æœŸå¾…çµæœ
  actual_result?: string;         // å®Ÿéš›ã®çµæœ
  error_message?: string;         // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  healed?: boolean;               // Healerã«ã‚ˆã‚‹ä¿®å¾©ãƒ•ãƒ©ã‚°
  visited_urls?: string[];        // è¨ªå•ã—ãŸURL
  feature?: string;               // ãƒ†ã‚¹ãƒˆã—ãŸæ©Ÿèƒ½
}
```

### 3.4 ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ï¼ˆCoverageDataï¼‰
```typescript
interface CoverageData {
  analysis_date: string;          // åˆ†ææ—¥æ™‚
  total_scenarios_executed: number; // å®Ÿè¡Œæ¸ˆã¿ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°
  coverage_summary: {
    percentage: number;           // ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆï¼…ï¼‰
    visited_pages: number;        // è¨ªå•æ¸ˆã¿ãƒšãƒ¼ã‚¸æ•°
    unvisited_pages: number;      // æœªè¨ªå•ãƒšãƒ¼ã‚¸æ•°
    tested_elements: number;      // ãƒ†ã‚¹ãƒˆæ¸ˆã¿è¦ç´ æ•°
    untested_elements: number;    // æœªãƒ†ã‚¹ãƒˆè¦ç´ æ•°
  };
  uncovered: {
    pages: UncoveredPage[];       // æœªè¨ªå•ãƒšãƒ¼ã‚¸ä¸€è¦§
    elements: UncoveredElement[]; // æœªæ“ä½œè¦ç´ ä¸€è¦§
  };
}
```

---

## 4. Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é€£æºä»•æ§˜

### 4.1 é€£æºæ–¹æ³•

#### 4.1.1 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹é€£æºï¼ˆæ¨å¥¨ï¼‰
```
othello/
â”œâ”€â”€ test-instructions/
â”‚   â””â”€â”€ instruction_iteration-N.json  # OthelloãŒä½œæˆ
â””â”€â”€ logs/
    â””â”€â”€ result_iteration-N.json       # Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä½œæˆ
```

**ãƒ•ãƒ­ãƒ¼**ï¼š
1. OthelloãŒ `instruction_iteration-N.json` ã‚’ä½œæˆ
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒVS Codeã§Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œ
3. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ `result_iteration-N.json` ã‚’ä½œæˆ
5. OthelloãŒçµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡ºãƒ»èª­ã¿è¾¼ã¿

#### 4.1.2 APIé€£æºï¼ˆå°†æ¥å¯¾å¿œï¼‰
VS Codeæ‹¡å¼µãŒREST APIã‚’æä¾›ã™ã‚‹å ´åˆï¼š
```javascript
POST http://localhost:3000/playwright-agent
Content-Type: application/json

{
  "target_url": "https://example.com",
  "instructions": { ... },
  "browser": "chromium"
}
```

### 4.2 æœŸå¾…ã•ã‚Œã‚‹çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç”Ÿæˆã™ã¹ãçµæœãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`result_iteration-N.json`ï¼‰:
```json
{
  "iteration": 1,
  "target_url": "https://example.com",
  "browser": "chromium",
  "start_time": "2025-10-13T14:30:00Z",
  "end_time": "2025-10-13T14:35:00Z",
  "duration_seconds": 300,
  "status": "success",
  "tests_generated": [
    "ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ",
    "ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ"
  ],
  "tests_executed": 2,
  "tests_passed": 2,
  "tests_failed": 0,
  "healer_actions": 0,
  "planner_suggestions": ["..."],
  "generated_tests": ["..."],
  "healer_details": [],
  "test_details": [
    {
      "name": "ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ",
      "status": "passed",
      "duration_seconds": 15,
      "inputs": ["testuser", "password123"],
      "expected_result": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é·ç§»",
      "visited_urls": ["https://example.com/login", "https://example.com/dashboard"],
      "feature": "ãƒ­ã‚°ã‚¤ãƒ³"
    }
  ]
}
```

---

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 5.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡
| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | èª¬æ˜ | å¯¾å¿œ |
|-----------|------|------|
| ConfigError | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å¤±æ•— | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦çµ‚äº† |
| AgentConnectionError | Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é€šä¿¡å¤±æ•— | ãƒªãƒˆãƒ©ã‚¤å¾Œã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| ResultTimeoutError | çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¡¨ç¤ºã—ã€æ‰‹å‹•ç¢ºèªã‚’ä¿ƒã™ |
| ParseError | çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ | ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º |

---

## 6. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 6.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```javascript
// __tests__/orchestrator.test.js
describe('Orchestrator', () => {
  test('ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜', async () => {
    const orchestrator = new Orchestrator(config, options);
    const instructions = { iteration: 1, target_url: 'https://example.com' };
    
    await orchestrator.saveTestInstructions(instructions, 1);
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    const filePath = path.join(config.getPath('test_instructions'), 'test-instructions_iteration-1.json');
    const exists = await fs.access(filePath).then(() => true).catch(() => false);
    expect(exists).toBe(true);
  });
});
```

---

## 7. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 7.1 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †
```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/k-sakQA/Othello.git
cd Othello

# 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

# 4. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npm link

# 5. VS Codeã§Playwrightã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ‹¡å¼µã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```

### 7.2 å‹•ä½œç¢ºèª
```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
othello --url https://example.com --max-iterations 1
```

---

## 8. æ”¹è¨‚å±¥æ­´
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 2.0 | 2025-10-13 | ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ç‰ˆã¨ã—ã¦å…¨é¢æ”¹è¨‚ | Claude |
| 1.0 | 2025-10-13 | åˆç‰ˆä½œæˆ | Claude |

---

ä»¥ä¸Š